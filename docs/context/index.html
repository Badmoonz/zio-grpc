<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.59">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-346180-20","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Context and Dependencies | ZIO gRPC</title><meta data-react-helmet="true" property="og:image" content="https://scalapb.github.io/zio-grpc/img/zio-grpc-social-light.png"><meta data-react-helmet="true" property="twitter:image" content="https://scalapb.github.io/zio-grpc/img/zio-grpc-social-light.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for ZIO gRPC"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Context and Dependencies | ZIO gRPC"><meta data-react-helmet="true" name="description" content="When implementing a server, ZIO gRPC allows you to specify that your service"><meta data-react-helmet="true" property="og:description" content="When implementing a server, ZIO gRPC allows you to specify that your service"><meta data-react-helmet="true" property="og:url" content="https://scalapb.github.io/zio-grpc//zio-grpc/docs/context"><link data-react-helmet="true" rel="shortcut icon" href="/zio-grpc/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://scalapb.github.io/zio-grpc//zio-grpc/docs/context"><link rel="stylesheet" href="/zio-grpc/styles.b85b596a.css">
<link rel="preload" href="/zio-grpc/styles.33aae8cf.js" as="script">
<link rel="preload" href="/zio-grpc/runtime~main.0ccdedf7.js" as="script">
<link rel="preload" href="/zio-grpc/main.5ecd7fea.js" as="script">
<link rel="preload" href="/zio-grpc/1.1099a831.js" as="script">
<link rel="preload" href="/zio-grpc/2.017f3284.js" as="script">
<link rel="preload" href="/zio-grpc/3.4fb298b6.js" as="script">
<link rel="preload" href="/zio-grpc/1be78505.32067935.js" as="script">
<link rel="preload" href="/zio-grpc/32.09ca16af.js" as="script">
<link rel="preload" href="/zio-grpc/a2f44fec.ad4a09d5.js" as="script">
<link rel="preload" href="/zio-grpc/17896441.7bc01cf7.js" as="script">
<link rel="preload" href="/zio-grpc/3a2a6d86.944c87bb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/zio-grpc/"><img class="navbar__logo" src="/zio-grpc/img/zio-grpc-hero.png" alt="ZIO gRPC"><strong class="navbar__title"> </strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zio-grpc/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scalapb/zio-grpc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/zio-grpc/"><img class="navbar__logo" src="/zio-grpc/img/zio-grpc-hero.png" alt="ZIO gRPC"><strong class="navbar__title"> </strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/zio-grpc/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/scalapb/zio-grpc" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menuLinkText_2zSB">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zio-grpc/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zio-grpc/docs/quickstart">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zio-grpc/docs/basics">Basics Tutorial</a></li></ul></li><li class="menu__list-item"><a class="menu__link menuLinkText_2zSB">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zio-grpc/docs/installation">Installing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/zio-grpc/docs/generated-code">Generated code</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/zio-grpc/docs/context">Context and Dependencies</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Context and Dependencies</h1></header><div class="markdown"><p>When implementing a server, ZIO gRPC allows you to specify that your service
depends on an environment of type <code>R</code> and a context of type <code>Context</code>.</p><p><code>Context</code> and <code>R</code> can be of any Scala type, however when they are not <code>Any</code> they have to be wrapped in an <code>Has[]</code>. This allows ZIO gRPC to combine two values (<code>Context with R</code>) when providing the values at effect execution time.</p><p>For example, we can define a service for which the effects depend on <code>Console</code>, and for each request we except to get context of type <code>User</code>. Note that <code>Console</code> is a type-alias to <code>Has[Console.Service]</code> so there is no need wrap it once more in an <code>Has</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">import zio.{Has, ZIO}</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import zio.console._</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import scalapb.zio_grpc.RequestContext</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import myexample.testservice.ZioTestservice.ZSimpleService</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import myexample.testservice.{Request, Response}</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import io.grpc.Status</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">case class User(name: String)</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object MyService extends ZSimpleService[Console, Has[User]] {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def sayHello(req: Request): ZIO[Console with Has[User], Status, Response] =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    for {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      user &lt;- ZIO.service[User]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      _ &lt;- putStrLn(&quot;I am here!&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    } yield Response(s&quot;Hello, ${user.name}&quot;)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div></div></div><p>As you can see above, we can access both the <code>User</code> and the <code>Console</code> in our effects. If one of the methods does not need to access the dependencies or context, the returned type from the method can be cleaned up to reflect that certain things are not needed.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="context-transformations"></a>Context transformations<a aria-hidden="true" tabindex="-1" class="hash-link" href="#context-transformations" title="Direct link to heading">#</a></h2><p>In order to be able to bind our service to a gRPC server, we need to have the
service&#x27;s Context type to be one of the supported types:</p><ul><li><code>Has[scalapb.zio_grpc.RequestContext]</code></li><li><code>Has[scalapb.zio_grpc.SafeMetadata]</code></li><li><code>Any</code></li></ul><p>The service <code>MyService</code> as defined above expects <code>Has[User]</code> as a context. In order to be able to bind it, we will transform it into a service that depends on a context of type <code>Has[RequestContext]</code>. To do this, we need to provide the function to produce a <code>User</code> out of a <code>RequestContext</code>. This way, when a request comes in, ZIO gRPC can take the <code>RequestContext</code> (which is request metadata such as headers and options), and use our function to construct a <code>User</code> and provide it into the environment of our original service.</p><p>In many typical cases, we may need to retrieve the user from a database, and thus we are using an effectful function <code>RequestContext =&gt; IO[Status, User]</code> to find the user.</p><p>For example, we can provide a function that returns an effect that always succeeds:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val fixedUserService =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  MyService.transformContextM((rc: RequestContext) =&gt; ZIO.succeed(User(&quot;foo&quot;)))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// fixedUserService: ZSimpleService[Console, Has[RequestContext]] = myexample.testservice.ZioTestservice$ZSimpleService$$anon$5$$anon$6@d599191</span></div></div></div></div></div><p>and we got our service, which still depends on an environment of type <code>Console</code>, however the context is now <code>Has[RequestContext]</code> so it can be bound to a gRPC server.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="accessing-metadata"></a>Accessing metadata<a aria-hidden="true" tabindex="-1" class="hash-link" href="#accessing-metadata" title="Direct link to heading">#</a></h3><p>Here is how we would extract a user from a metadata header:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">import zio.IO</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import scalapb.zio_grpc.{ServiceList, ServerMain}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val UserKey = io.grpc.Metadata.Key.of(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  &quot;user-key&quot;, io.grpc.Metadata.ASCII_STRING_MARSHALLER)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// UserKey: io.grpc.Metadata.Key[String] = Key{name=&#x27;user-key&#x27;}</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">def findUser(rc: RequestContext): IO[Status, User] =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  rc.metadata.get(UserKey).flatMap {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case Some(name) =&gt; IO.succeed(User(name))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    case _          =&gt; IO.fail(Status.UNAUTHENTICATED.withDescription(&quot;No access!&quot;))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val rcService =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  MyService.transformContextM(findUser)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// rcService: ZSimpleService[Console, Has[RequestContext]] = myexample.testservice.ZioTestservice$ZSimpleService$$anon$5$$anon$6@7cf5db58</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object MyServer extends ServerMain {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def services = ServiceList.add(rcService)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="depending-on-a-service"></a>Depending on a service<a aria-hidden="true" tabindex="-1" class="hash-link" href="#depending-on-a-service" title="Direct link to heading">#</a></h3><p>A context transformation may introduce a dependency on another service. For example, you
may want to organize your code such that there is a <code>UserDatabase</code> service that provides
a <code>fetchUser</code> effect that retrieves users from a database. Here is how you can do this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">type UserDatabase = Has[UserDatabase.Service]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object UserDatabase {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  trait Service {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def fetchUser(name: String): IO[Status, User]</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  // accessor</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  def fetchUser(name: String): ZIO[UserDatabase, Status, User] =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    ZIO.accessM[UserDatabase](_.get.fetchUser(name))</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  val live = zio.ZLayer.succeed(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    new Service {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">      def fetchUser(name: String): IO[Status, User] =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        IO.succeed(User(name))</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    })</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div></div></div><p>Now,
The context transformation effect we apply may introduce an additional environmental dependency to our service. For example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">import zio.clock._</span></div><div class="token-line" style="color:#403f53"><span class="token plain">import zio.duration._</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val myServiceAuthWithDatabase  =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  MyService.transformContextM {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    (rc: RequestContext) =&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        rc.metadata.get(UserKey)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        .someOrFail(Status.UNAUTHENTICATED)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        .flatMap(UserDatabase.fetchUser)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  }</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// myServiceAuthWithDatabase: ZSimpleService[Console with UserDatabase, Has[RequestContext]] = myexample.testservice.ZioTestservice$ZSimpleService$$anon$5$$anon$6@6f80363d</span></div></div></div></div></div><p>And now our service not only depends on a <code>Console</code>, but also on a <code>UserDatabase</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="using-a-service-as-zlayer"></a>Using a service as ZLayer<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-a-service-as-zlayer" title="Direct link to heading">#</a></h2><p>We can turn our service into a ZLayer:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">val myServiceLive = myServiceAuthWithDatabase.toLayer</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// myServiceLive: zio.ZLayer[Console with UserDatabase, Nothing, Has[ZSimpleService[Any, Has[RequestContext]]]] = Managed(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   zio.ZManaged$$anon$2@219bb6ac</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// )</span></div></div></div></div></div><p>notice how the dependencies moved to the input side of the <code>Layer</code> and the resulting layer is of
type <code>ZSimpleService[Any, Has[RequestContext]]]</code>, which means no environment is expected, and it assumes
a <code>Has[RequestContext]</code> context. To use this layer in an app, we can wire it like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scala codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#403f53;background-color:#FBFBFB"><div class="token-line" style="color:#403f53"><span class="token plain">import scalapb.zio_grpc.ServerLayer</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val serverLayer =</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    ServerLayer.fromServiceLayer(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">        io.grpc.ServerBuilder.forPort(9000)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    )(myServiceLive)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// serverLayer: zio.ZLayer[Console with UserDatabase, Throwable, Has[scalapb.zio_grpc.Server.Service]] = Fold(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   Managed(zio.ZManaged$$anon$2@219bb6ac),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   Managed(zio.ZManaged$$anon$2@28531f5),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   Managed(zio.ZManaged$$anon$2@471f3de0)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// )</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">val ourApp = (UserDatabase.live ++ Console.any) &gt;&gt;&gt;</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    serverLayer</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// ourApp: zio.ZLayer[Any with Console, Throwable, Has[scalapb.zio_grpc.Server.Service]] = Fold(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   ZipWithPar(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//     Managed(zio.ZManaged$$anon$2@9d5b781),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//     Managed(zio.ZManaged$$anon$2@502df05a),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//     zio.ZLayer$$Lambda$11070/1386653462@168c8cc7</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   ),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   Managed(zio.ZManaged$$anon$2@cb10432),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   Fold(</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//     Managed(zio.ZManaged$$anon$2@219bb6ac),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//     Managed(zio.ZManaged$$anon$2@28531f5),</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//     Managed(zio.ZManaged$$anon$2@471f3de0)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">//   )</span></div><div class="token-line" style="color:#403f53"><span class="token plain">// )</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain">object LayeredApp extends zio.App {</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    def run(args: List[String]) = ourApp.build.useForever.exitCode</span></div><div class="token-line" style="color:#403f53"><span class="token plain">}</span></div></div></div></div></div><p><code>serverLayer</code> wraps around our service layer to produce a server. Then, <code>ourApp</code> layer is constructed such that it takes <code>UserDatabase.live</code> in conjuction to a passthrough layer for <code>Console</code> to satisfy the two input requirements of <code>serverLayer</code>. The outcome, <code>ourApp</code>, is a <code>ZLayer</code> that can produce a <code>Server</code> from a <code>Console</code>. In the <code>run</code> method we build the layer and run it. Note that we are directly using a <code>zio.App</code> rather than <code>ServerMain</code> which does
not support this use case yet.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/scalapb/zio-grpc/edit/master/docs/context.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/zio-grpc/docs/generated-code"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Generated Code Reference</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3klQ"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#context-transformations" class="table-of-contents__link">Context transformations</a><ul><li><a href="#accessing-metadata" class="table-of-contents__link">Accessing metadata</a></li><li><a href="#depending-on-a-service" class="table-of-contents__link">Depending on a service</a></li></ul></li><li><a href="#using-a-service-as-zlayer" class="table-of-contents__link">Using a service as ZLayer</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zio-grpc/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/zio-grpc/docs/installation">Installation</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/scalapb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://gitter.im/ScalaPB/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/scalapb/zio-grpc" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 <a href="https://www.linkedin.com/in/nadav-samet/">Nadav Samet</a></div></div></div></footer></div>
<script src="/zio-grpc/styles.33aae8cf.js"></script>
<script src="/zio-grpc/runtime~main.0ccdedf7.js"></script>
<script src="/zio-grpc/main.5ecd7fea.js"></script>
<script src="/zio-grpc/1.1099a831.js"></script>
<script src="/zio-grpc/2.017f3284.js"></script>
<script src="/zio-grpc/3.4fb298b6.js"></script>
<script src="/zio-grpc/1be78505.32067935.js"></script>
<script src="/zio-grpc/32.09ca16af.js"></script>
<script src="/zio-grpc/a2f44fec.ad4a09d5.js"></script>
<script src="/zio-grpc/17896441.7bc01cf7.js"></script>
<script src="/zio-grpc/3a2a6d86.944c87bb.js"></script>
</body>
</html>